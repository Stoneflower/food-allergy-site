<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSVå¤‰æ›ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin: 10px 0; }
        .btn { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .btn:hover { background-color: #0056b3; }
        .drop-zone { border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 10px 0; }
        .drop-zone.dragover { border-color: #007bff; background-color: #f0f8ff; }
        input[type="file"] { display: none; }
        .preview { margin: 10px 0; padding: 10px; background-color: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ğŸ”§ é«˜ç²¾åº¦CSVå¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="section">
        <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h3>
        <div class="form-group">
            <label>å…¥åŠ›æ–¹å¼ã‚’é¸æŠ:</label>
            <select id="inputType" onchange="toggleInputType()">
                <option value="csv">CSVãƒ•ã‚¡ã‚¤ãƒ«</option>
                <option value="json">JSONãƒ‡ãƒ¼ã‚¿</option>
                <option value="pdf">PDFãƒ•ã‚¡ã‚¤ãƒ«</option>
                <option value="image">ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«</option>
            </select>
        </div>
        
        <!-- CSVå…¥åŠ› -->
        <div id="csvInput" class="form-group">
            <label>CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:</label>
            <div id="csvDropZone" class="drop-zone" ondrop="handleCSVDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <p>ğŸ“ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                <p>ã¾ãŸã¯</p>
                <input type="file" id="csvFile" accept=".csv" onchange="handleCSVUpload()">
                <button class="btn" onclick="document.getElementById('csvFile').click()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
            </div>
            <div id="csvPreview" class="preview" style="display: none;">
                <h4>ğŸ“„ CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                <div id="csvContent"></div>
                <button class="btn" onclick="processCSV()">CSVã‚’å‡¦ç†</button>
            </div>
        </div>
        
        <!-- JSONå…¥åŠ› -->
        <div id="jsonInput" class="form-group" style="display: none;">
            <label>JSONãƒ‡ãƒ¼ã‚¿:</label>
            <textarea id="jsonData" rows="10" style="width: 100%;"></textarea>
            <button class="btn" onclick="loadSampleData()">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿</button>
        </div>
        
        <!-- PDFå…¥åŠ› -->
        <div id="pdfInput" class="form-group" style="display: none;">
            <label>PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:</label>
            <div id="pdfDropZone" class="drop-zone" ondrop="handlePDFDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <p>ğŸ“„ PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                <p>ã¾ãŸã¯</p>
                <input type="file" id="pdfFile" accept=".pdf" onchange="handlePDFUpload()">
                <button class="btn" onclick="document.getElementById('pdfFile').click()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
            </div>
            <div id="pdfPreview" class="preview" style="display: none;">
                <h4>ğŸ“„ PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                <div id="pdfContent"></div>
                <button class="btn" onclick="processPDF()">PDFã‚’å‡¦ç†</button>
            </div>
        </div>
        
        <!-- ç”»åƒå…¥åŠ› -->
        <div id="imageInput" class="form-group" style="display: none;">
            <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:</label>
            <div id="imageDropZone" class="drop-zone" ondrop="handleImageDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <p>ğŸ–¼ï¸ ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                <p>ã¾ãŸã¯</p>
                <input type="file" id="imageFile" accept=".jpg,.jpeg,.png,.bmp,.heic,.heif" onchange="handleImageUpload()">
                <button class="btn" onclick="document.getElementById('imageFile').click()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
            </div>
            <div id="imagePreview" class="preview" style="display: none;">
                <h4>ğŸ–¼ï¸ ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                <img id="previewImage" style="max-width: 300px; max-height: 200px;">
                <div id="imageContent"></div>
                <button class="btn" onclick="processImage()">ç”»åƒã‚’OCRå‡¦ç†</button>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h3>ğŸ“‹ åˆ—ã®é¸æŠ</h3>
        <div id="columnCheckboxes"></div>
        <button class="btn" onclick="previewData()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
    </div>
    
    <div class="section">
        <h3>âš¡ å¤‰æ›å®Ÿè¡Œ</h3>
        <button class="btn" onclick="convertData()">ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›</button>
        <button class="btn" onclick="exportCSV()">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
    </div>
    
    <div id="result" class="section" style="display: none;">
        <h3>ğŸ“Š å¤‰æ›çµæœ</h3>
        <div id="resultContent"></div>
    </div>

    <script>
        let currentData = [];
        
        // å…¥åŠ›ã‚¿ã‚¤ãƒ—ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleInputType() {
            console.log('toggleInputType called');
            const inputType = document.getElementById('inputType').value;
            const csvInput = document.getElementById('csvInput');
            const jsonInput = document.getElementById('jsonInput');
            const pdfInput = document.getElementById('pdfInput');
            const imageInput = document.getElementById('imageInput');
            
            // ã™ã¹ã¦éè¡¨ç¤ºã«ã™ã‚‹
            csvInput.style.display = 'none';
            jsonInput.style.display = 'none';
            pdfInput.style.display = 'none';
            imageInput.style.display = 'none';
            
            // é¸æŠã•ã‚ŒãŸã‚¿ã‚¤ãƒ—ã®ã¿è¡¨ç¤º
            if (inputType === 'csv') {
                csvInput.style.display = 'block';
            } else if (inputType === 'json') {
                jsonInput.style.display = 'block';
            } else if (inputType === 'pdf') {
                pdfInput.style.display = 'block';
            } else if (inputType === 'image') {
                imageInput.style.display = 'block';
            }
        }
        
        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å…±é€šæ©Ÿèƒ½
        function handleDragOver(event) {
            console.log('handleDragOver called');
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.add('dragover');
        }
        
        function handleDragLeave(event) {
            console.log('handleDragLeave called');
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
        }
        
        // CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        function handleCSVDrop(event) {
            console.log('handleCSVDrop called');
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type === 'text/csv' || file.name.toLowerCase().endsWith('.csv')) {
                    document.getElementById('csvFile').files = files;
                    handleCSVUpload();
                } else {
                    alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                }
            }
        }
        
        // CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        function handleCSVUpload() {
            console.log('handleCSVUpload called');
            const file = document.getElementById('csvFile').files[0];
            if (!file) {
                console.log('No file selected');
                return;
            }
            console.log('File selected:', file.name, 'Type:', file.type);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csvContent = e.target.result;
                
                // CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
                console.log('Displaying CSV preview');
                document.getElementById('csvPreview').style.display = 'block';
                document.getElementById('csvContent').innerHTML = `
                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${file.name}</p>
                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:</strong> ${(file.size / 1024).toFixed(2)} KB</p>
                    <h5>ğŸ“„ CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæœ€åˆã®5è¡Œï¼‰:</h5>
                    <pre style="background-color: white; padding: 10px; border-radius: 3px; max-height: 200px; overflow-y: auto;">${csvContent.split('\n').slice(0, 5).join('\n')}</pre>
                `;
            };
            reader.readAsText(file);
        }
        
        // PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        function handlePDFDrop(event) {
            console.log('handlePDFDrop called');
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
                    document.getElementById('pdfFile').files = files;
                    handlePDFUpload();
                } else {
                    alert('PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                }
            }
        }
        
        // PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        function handlePDFUpload() {
            console.log('handlePDFUpload called');
            const file = document.getElementById('pdfFile').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('pdfPreview').style.display = 'block';
                document.getElementById('pdfContent').innerHTML = `
                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${file.name}</p>
                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:</strong> ${(file.size / 1024).toFixed(2)} KB</p>
                `;
            };
            reader.readAsDataURL(file);
        }
        
        // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        function handleImageDrop(event) {
            console.log('handleImageDrop called');
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/bmp', 'image/heic', 'image/heif'];
                if (validTypes.includes(file.type) || file.name.toLowerCase().match(/\.(jpg|jpeg|png|bmp|heic|heif)$/)) {
                    document.getElementById('imageFile').files = files;
                    handleImageUpload();
                } else {
                    alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                }
            }
        }
        
        // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        function handleImageUpload() {
            console.log('handleImageUpload called');
            const file = document.getElementById('imageFile').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('imageContent').innerHTML = `
                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${file.name}</p>
                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:</strong> ${(file.size / 1024).toFixed(2)} KB</p>
                `;
            };
            reader.readAsDataURL(file);
        }
        
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadSampleData() {
            console.log('loadSampleData called');
            const sampleData = [
                {
                    "menu_name": "ã‚¢ã‚¤ã‚¹ã‚«ãƒ•ã‚§ãƒ©ãƒ†",
                    "allergies": {
                        "åµ": "none",
                        "ä¹³": "direct",
                        "å°éº¦": "none"
                    }
                }
            ];
            document.getElementById('jsonData').value = JSON.stringify(sampleData, null, 2);
        }
        
        // CSVã‚’å‡¦ç†
        function processCSV() {
            console.log('processCSV called');
            alert('CSVå‡¦ç†æ©Ÿèƒ½ã¯å®Ÿè£…ä¸­ã§ã™');
        }
        
        // PDFã‚’å‡¦ç†
        function processPDF() {
            console.log('processPDF called');
            alert('PDFå‡¦ç†æ©Ÿèƒ½ã¯å®Ÿè£…ä¸­ã§ã™');
        }
        
        // ç”»åƒã‚’OCRå‡¦ç†
        function processImage() {
            console.log('processImage called');
            alert('ç”»åƒOCRå‡¦ç†æ©Ÿèƒ½ã¯å®Ÿè£…ä¸­ã§ã™');
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        function previewData() {
            console.log('previewData called');
            alert('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã¯å®Ÿè£…ä¸­ã§ã™');
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›
        function convertData() {
            console.log('convertData called');
            alert('ãƒ‡ãƒ¼ã‚¿å¤‰æ›æ©Ÿèƒ½ã¯å®Ÿè£…ä¸­ã§ã™');
        }
        
        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportCSV() {
            console.log('exportCSV called');
            alert('CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯å®Ÿè£…ä¸­ã§ã™');
        }
        
        // ãƒšãƒ¼ã‚¸å…¨ä½“ã§ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’ç„¡åŠ¹åŒ–
        document.addEventListener('dragover', function(event) {
            event.preventDefault();
            event.stopPropagation();
        });
        
        document.addEventListener('drop', function(event) {
            event.preventDefault();
            event.stopPropagation();
        });
        
        console.log('CSV Converter script loaded');
    </script>
</body>
</html>
